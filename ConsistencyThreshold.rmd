---
title: "Consistency Check for Threshold values"
author: "Rifat"
date: "December 20, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r,echo=FALSE,comment=NA,results='hide', message=FALSE, warning=FALSE}

source("consistency_helper.R")

location <- "/ExperimentalData/DBpedia/"


# Entities

fileName <- "DBpedia10ClassEntityCount.csv"

dbpedia.EntityCount = loadCsv(fileName,location)

dbpedia.EntityCount.days= ddply(dbpedia.EntityCount,.(class), here(transform), days=days(Release))

```

## Consistency Check foaf:Person


```{r,echo=FALSE,comment=NA,results='hide', message=FALSE, warning=FALSE}

# Properties

fileName <- "foaf-person.csv"

foaf.Person = loadCsv(fileName,location)

foaf.Person.Version= data.frame(Property=foaf.Person$property,
                                Count201504=foaf.Person$v2015.02.05,
                                Count201510=foaf.Person$v2015.10.02,
                                Count201604=foaf.Person$v2016.04.01)



# Looking at only those properties present on the current version of foaf.person

foaf.person.NonZero = foaf.Person.Version[foaf.Person.Version$Count201604 !=0,]

dbo.foaf.person.Entity = dbpedia.EntityCount.days[dbpedia.EntityCount.days$class=="foaf-person",]

rowCount= nrow(dbo.foaf.person.Entity)

for(i in 1:nrow(foaf.person.NonZero)){
  
  foaf.person.NonZero[i,]$Count201604 = round(foaf.person.NonZero[i,]$Count201604/dbo.foaf.person.Entity[rowCount,]$count,6) 
  
  foaf.person.NonZero[i,]$Count201510 = round(foaf.person.NonZero[i,]$Count201510/dbo.foaf.person.Entity[rowCount-1,]$count,6)
  
  foaf.person.NonZero[i,]$Count201504 = round(foaf.person.NonZero[i,]$Count201504/dbo.foaf.person.Entity[rowCount-2,]$count,6)
  
}

max(foaf.person.NonZero$Count201504)




cdf_fun <- ecdf(foaf.person.NonZero$Count201604)  
plot(cdf_fun, xlab="Number of prop",  
     ylab="Frequency",main="")

dfNorm <- as.data.frame(lapply(foaf.person.NonZero[2:4], normalize))

cdf_fun <- ecdf(dfNorm$Count201604)  
plot(cdf_fun, xlab="Number of prop",  
     ylab="Frequency",main="")

dfNorm$Class="foaf-person"
foaf.person.NonZero$Class="foaf-person"

# outlier removal-- remove those lower than the total entity count

max(foaf.person.NonZero$Count201604)

dbo.foaf.person.Entity[rowCount,]$count

lowerdf = foaf.person.NonZero[foaf.person.NonZero$Count201604<dbo.foaf.person.Entity[rowCount,]$count,]

max(lowerdf$Count201504)

nrow(lowerdf)

p <- ggplot(lowerdf, aes(x= Class, y = Count201604)) + geom_boxplot()

p


lowerdf



p<-ggplot(dfNorm, aes(x=Count201510)) + stat_ecdf() 

p<-ggplot(foaf.person.NonZero, aes(x=Count201504)) + stat_ecdf() 

library(MASS)




```

## 3cixty analysis on consistency threshold

(1) Select multiple version of KB releases

(2) In this analysis we select last three releases of 3cixty KB

(3) Based on the last three releasers we removed those outliers from the dataset.

(4) Normalization was done based the totoal entity count for last three releases.

(5) Heuristics of capturing consistency value.

(6) Desing a ranking function to detect the corresponding value


Threshold Level	
Description

Max

Assume you create a Threshold with value 100 and level as Maximum. The collected data being greater than this value indicates a problem.

Min

Assume you create a Threshold with value 100 and level as Minimum. The collected data being lesser than this value indicates a problem.

Equal

Assume you create a Threshold with value 100 and level as Equal. The collected data being equal to this value indicates a problem.